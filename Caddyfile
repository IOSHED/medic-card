test-med.ru {
# Редирект http -> https
    @http {
              protocol http
          }
    redir @http https://{host}{uri} permanent

# ACME challenge для SSL
    @acme {
              path /.well-known/acme-challenge/*
          }
    handle @acme {
                     root * /srv/static/.well-known/acme-challenge
                     file_server
                 }

# Статические файлы
    handle /static/* {
                         root * /srv/static
                         file_server
                         header Cache-Control "public, max-age=31536000"
                     }

# Медиа файлы
    handle /media/* {
                        root * /srv/media
                        file_server
                        header Cache-Control "public, max-age=3600"
                    }

# Все остальное - в Django
    handle {
               reverse_proxy django:8000 {
                                             header_up X-Forwarded-Proto {scheme}
                                             header_up X-Forwarded-Host {host}
                                             header_up X-Real-IP {remote}
                                         }
           }
}

www.test-med.ru {
    redir https://test-med.ru{uri} permanent
}